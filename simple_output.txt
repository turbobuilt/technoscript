DEBUG: Program started
DEBUG: About to process command line arguments
DEBUG: Reading from file: simple_test.ts
=== Testing from file: simple_test.ts ===
DEBUG: Starting parsing...
DEBUG: Parsing completed successfully
DEBUG: Starting analysis...
DEBUG Analyzer: Starting collectVariables...
DEBUG Analyzer: collectVariables completed
DEBUG Analyzer: Starting setupParentPointers...
DEBUG Analyzer: setupParentPointers completed
DEBUG Analyzer: Starting analyzeScope...
DEBUG findVariable: Looking for 'param' from scope depth 1
DEBUG findVariable: Starting parent traversal from scope depth 1
DEBUG findVariable: Checking scope depth 0 (traversal #1)
DEBUG findVariable: Checking current scope for 'param'
DEBUG findVariable: Found 'param' in current scope
DEBUG findVariable: Looking for 'global_var' from scope depth 1
DEBUG findVariable: Starting parent traversal from scope depth 1
DEBUG findVariable: Checking scope depth 0 (traversal #1)
DEBUG findVariable: Found 'global_var' in scope depth 0
DEBUG findVariable: Adding dependencies for 'global_var'
DEBUG findVariable: Dependencies added successfully for 'global_var'
DEBUG findVariable: Looking for 'simple_func' from scope depth 0
DEBUG findVariable: Starting parent traversal from scope depth 0
DEBUG findVariable: Checking current scope for 'simple_func'
DEBUG findVariable: Found 'simple_func' in current scope
DEBUG findVariable: Looking for 'global_var' from scope depth 0
DEBUG findVariable: Starting parent traversal from scope depth 0
DEBUG findVariable: Checking current scope for 'global_var'
DEBUG findVariable: Found 'global_var' in current scope
DEBUG Analyzer: analyzeScope completed
DEBUG Analyzer: Starting updateAllNeededArrays...
DEBUG Analyzer: updateAllNeededArrays completed
DEBUG Analyzer: Starting packScopes...
DEBUG Analyzer: packScopes completed
DEBUG Analyzer: Starting buildAllScopeDepthToParentParameterIndexMaps...
DEBUG buildScopeDepthToParentParameterIndexMap: Function 'simple_func' has 1 regular params, needs 1 scopes
DEBUG buildScopeDepthToParentParameterIndexMap: depth 0 -> param index 1 (regular params=1 + offset=0)
DEBUG buildScopeDepthToParentParameterIndexMap: Final map for function 'simple_func':
DEBUG:   depth 0 -> param index 1
DEBUG Analyzer: buildAllScopeDepthToParentParameterIndexMaps completed
DEBUG: Analysis completed successfully
DEBUG: Actual print_int64 address: 0x5cf95563fa27
DEBUG: Starting code generation...
DEBUG initExternFunctions: storing print_int64 at address 0x5cf95563fa27
DEBUG createClosures: Starting for scope at depth 0, type=1
DEBUG createClosures: Scope has 2 variables
DEBUG createClosures: Processing variable 'global_var', type=1
DEBUG createClosures: Processing variable 'simple_func', type=2
DEBUG createClosures: Creating closure for function 'simple_func'
DEBUG createClosures: Function 'simple_func' needs 1 parent scopes
DEBUG createClosures: Storing 1 parent scope addresses for function 'simple_func'
DEBUG createClosures: Processing scope dependency 1/1: depth=0
DEBUG createClosures: Found parameter mapping: depth 0 -> absolute param index 1
DEBUG createClosures: Creating closure - loading scope for depth 0 from absolute param 1
DEBUG: Storing current scope (R15) for depth 0
DEBUG: generateClosureCall - calling function 'simple_func' with 1 args, 1 hidden params
DEBUG: Processing regular parameter 0
DEBUG loadVariableIntoRegister: var='global_var' paramIndex=-1
DEBUG: node=0x5cf95f3043d0, definingScope=0x5cf95f3035e0 (depth=0), accessingScope=0x5cf95f3035e0 (depth=0)
DEBUG: var defined in scope depth=0
DEBUG: var accessed in scope depth=0
DEBUG: Loading from current scope R15+0
DEBUG: Moving parameter 0 from RAX to RDI
DEBUG loadVariableDefiningScopeAddressIntoRegister: var='simple_func' paramIndex=-1 paramOffset=0
DEBUG: var defined in scope depth=0
DEBUG: var accessed in scope depth=0
DEBUG: Loading current scope address from R15
DEBUG: target_reg = 10, Register::R15 = 15
DEBUG: Target register is NOT R15, calling emitMovRegFromReg
DEBUG: Processing hidden parameter 0 (total param index 1)
DEBUG: Moving hidden param 0 from RAX to RSI
DEBUG loadVariableDefiningScopeAddressIntoRegister: var='simple_func' paramIndex=-1 paramOffset=0
DEBUG: var defined in scope depth=0
DEBUG: var accessed in scope depth=0
DEBUG: Loading current scope address from R15
DEBUG: target_reg = 11, Register::R15 = 15
DEBUG: Target register is NOT R15, calling emitMovRegFromReg
DEBUG: About to call function
DEBUG: === STARTING code generation for function 'simple_func' at depth=1 ===
DEBUG: === STARTING function prologue for 'simple_func' ===
DEBUG: Function has 1 regular params and 1 hidden params
DEBUG: Saving parameter registers before heap allocation
DEBUG: Allocating heap memory for function scope (size=16)
DEBUG: Copying parameter 0 ('param') to offset 0
DEBUG: Copying from RDI to R15+0
DEBUG: Copying hidden parameter 0 (total param index 1) to offset 8
DEBUG loadVariableIntoRegister: var='param' paramIndex=-1
DEBUG: node=0x5cf95f3041b0, definingScope=0x5cf95f303f90 (depth=1), accessingScope=0x5cf95f303f90 (depth=1)
DEBUG: var defined in scope depth=1
DEBUG: var accessed in scope depth=1
DEBUG: Loading from current scope R15+0
DEBUG generatePrintStatement: retrieved print_int64 address 0x5cf95563fa27
DEBUG loadVariableIntoRegister: var='global_var' paramIndex=1
DEBUG: node=0x5cf95f3042b0, definingScope=0x5cf95f3035e0 (depth=0), accessingScope=0x5cf95f303f90 (depth=1)
DEBUG: Should use parent scope access - checking parameter index map
DEBUG: Parameter map size: 1
DEBUG: depth 0 -> param index 1
DEBUG: var defined in scope depth=0
DEBUG: var accessed in scope depth=1
DEBUG: Loading from parent scope via parameter offset 8 + variable offset 0
DEBUG: Using parameter offset: 8
DEBUG: About to load scope address from R15+8
DEBUG: About to load variable from scope+0
DEBUG generatePrintStatement: retrieved print_int64 address 0x5cf95563fa27
DEBUG: === FINISHED code generation for function 'simple_func' at depth=1 ===
DEBUG: Code generation completed successfully
DEBUG: Writing program to executable...
DEBUG: print_int64 ENTRY - called with value=42
DEBUG: About to print to stdout...
42
DEBUG: print_int64 SUCCESS - finished printing
DEBUG: print_int64 ENTRY - called with value=42
DEBUG: About to print to stdout...
42
DEBUG: print_int64 SUCCESS - finished printing
